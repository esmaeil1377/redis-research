<div dir = 'rtl'>

# ردیس (Redis)
برای تعریف ```Redis``` (ردیس) سری به [سایت](https://redis.io) رسمی آن زدیم، در این وب‌سایت تعریف شده که:
#### ```  Redis  مخفف عبارت Remote Dlctionary Server است. در واقع ردیس یک نوع ساختمانِ داده است که در RAM قرار می‌گیرد و اطلاعات به صورت موقتی در آن ذخیره می‌شوند.  ```
ردیس داده‌ها را با سیستم ```Key-value``` نگهداری می‌کند و به لطف این ویژگی از آنجایی که رابطه پیچیده‌ای میان داده‌ها ایجاد نمی‌شود، دسترسی و بازیابی این اطلاعات بسیار ساده‌تر خواهد شد.
### Key-Value چیست؟
Key-Value نوعی سرور یا محل ذخیره‌سازی است که در آن اطلاعات به صورت جفت‌های کلید (Key) و مقدار (Value) ذخیره می‌شوند. مثلاً اگر من بگویم Name = Ali، کلید من می‌شود Name و مقدار آن می‌شود Ali.
## تاریخچه Redis:
```Redis``` در ابتدا توسط یک توسعه دهنده ایتالیایی به نام ```Salvatore Sanfilippo``` ایجاد شد در مارس ۲۰۱۰ توسط شرکت ```vmware``` مورد توجه قرار گرفت و به صورت جدی بر روی این پروژه سرمایه گذاری شد.
در june 2015 توسعه تحت حمایت شرکت ```Redis Labs``` آغاز شد.
## تفاوت Redis با دیگر پایگاه داده‌ها چیست؟
Redis با پایگاه داده‌هایی مثل MySQL و Oracle کاملاً متفاوت است؛ چرا که در آن خبری از ستون‌ها، ردیف‌ها، table ها، توابع و … نیست. همچنین ردیس از دستورات Select، Insert، Updat، Delete و … نیز استفاده نمی‌کند.

در عوض، ردیس از ساختمان داده‌هایی مثل String، Lists ،Sets ،Hashes و …، برای مرتب کردن اطلاعات استفاده می‌کند. 
## 5 ساختاری که با استفاده از ردیس می توانیم ذخیر کنیم:

## آشنایی با Redis Persistence:
Redis فقط اطلاعات را روی رم نگهداری نمی‌کند بلکه Redis به ۲ روش که این روش قابل انتخاب شدن است از اطلاعات یک بکاپ می‌گیرد و روی هارد ذخیره می‌کند.
### روش اول RDB
روش```RDB```  روش پیشفرضی است که Redis از اطلاعات بکاپ میگیرد و نیازی نیست که کار خاصی توسط ما انجام شود. در این روش Redis هر چند ثانیه یکبار (این زمان قابل تنظیم است) از اطلاعاتی که درون رم است بکاپ میگیرد و درون هارد ذخیره میکند. معمولا اگر اطلاعات ذخیره شده از درجیه اهمیت بالایی برخوردار نباشد این روش، روش خوبی است اما اگه اطلاعاتی که ذخیره میشوند مهم باشند این روش پیشنهاد نمیشود زیرا مثلا 
فرض میکنیم  که داریم اطلاعات تعدادی کاربر را ذخیره میکنیم و Redis  تنظیم شده که هر ۱۰ ثانیه بکاپ بگیرد. ما در ۴ ثانیه اطلاعات ۱۰۰۰۰ یوزر وارد کردیم اما بعد از ثانیه ششم سرور خاموش میشود !!! در این سناریو خیلی راحت اطلاعات کل کاریر ها را از دست میدهیم و  برای اینکه بتوانیم اینگونه مسائل را  کنترل کنیم باید از روش AOF استفاده کنیم.
### روش دوم AOF
روش ```AOF``` وقتی استفاده میشود که قصد داریم که شانس از دست رفتن اطلاعات را به صفر برسانیم. در این حالت هر ثانیه از اطلاعات بکاپ گرفته میشود و درون یک فایل داخل هارد  ذخیره میشود پس با این کار بعید است که اطلاعتی از دست برود برای فعال سازی این قابلیت کافی است که درون فایل کانفیگ Redis قسمت ```appendonly``` از no به yes تغیر دهیم.
## کاربردهای Redis:
بالاتر اشاره کردم که Redis کاربرد های زیادی داره که تغریبا توی تمام اون زمینه ها هم خوب عمل کرده این قسمت قراره که با این کاربرد ها آشنا بشیم.
### پایگاه داده
ردیس میتواند برای ما نقش یک پایگاه داده بازی کند  یعنی با استفاده از آن میتوانیم یکسری اطلاعات به صورت key و value درون رم ذخیره کنیم و یا یکسری از value ها را با استفاده از  key منتاظر با آن بخوانیم. مزیت ردیس نسبت به بقیه پایگاه های داده سرعت فوق العاده زیاد آن است.
### سیستم cache
یکی از کاربرد های اصلی و مهم Redis این است که میتواند نقش Caching  را در پروژه ما به عهده بگیرد. تقریبا به جرئت میتوان گفت که Redis در این زمینه بهترین گزینه موجود است و سیستم های زیادی مانند ```laravel``` از اون به صورت داخلی پشتیبانی می کند.
### سیستم message broker
message broker ها میتوانند یک پیام از یک برنامه به یک برنامه دیگه ارسال کنند فارغ از این که زبان برنامه نویسی و محیط این دو برنامه چیست و چطور کار میکنند یا توی یک سرور هستند یا نه. 
 Redis هم در این زمینه کار کرده البته که توی این زمینه به قدرت ```RabbitMQ``` کار نکرده ولی این سیستم ویژگی های خودش را دارد که تقریبا سناریو های قابل استفاده زیادی برای خودش ایجاد کرده که میتواند حتی بهتر از RabbitMQ فعالیت کند.
Redis به این قابلیت Pub/Sub میگوید که تقریبا خیلی ساده است کافی است سیستم فرستنده PUBLISH کند و سیستم گیرنده SUBSCRIBE کند که خیلی راحت با یک خط دستور میشود این کار را انجام داد. مزیت Redis مثل همیشه دوباره سرعت آن است که تقریبا بی نظیر است.
برعکس RabbitMQ اینجا هیج خبری از exchange و queue نیست و مراحل خیلی ساده انجام میشود همچنین  اطلاعات ارسالی از publisher به subscriber هیچ جا ذخیره نمیشود  و اگر subscriber وجود نداشته باشد اطلاعات از بین میرود
مثال جالب Redis Pub/Sub در این زمینه این است که  Redis مانند تلوزیون که یک فیلم PUBLISH میکند و یک بیننده اون فیلم را SUBSCRIBE میکند و اگر بیننده وجود نداشته باشد همه اطلاعات ازبین خواهد رقت.


## مزایای استفاده از Redis:

* رایگان و کدباز
* سادگی در استفاده
* ماندگاری (persistence) : اطلاعات شما در اثر ریستارت سرور از بین نمی رود! 
* پشتیبانی از Replication : ردیس به خوبی از Replication پشتیبانی میکند شما میتوانید سرورهای
* مختلفی را به صورت Master/Slave یا سناریوهای دلخواه خود اجرا کنید.
* استفاده از طیف وسیعی از ساختمان داده ها (Data Type)
* سرعت پاسخدهی فوق العاده
## معایب استفاده از Redis:
* درست است که Redis با استفاده از ساختار In-Memory یا مقیم در حافظه کار می کند که باعث سرعت دسترسی و پاسخدهی بسیار عالی می گردد اما حافظه Ram در سرورها و سرورهای ابری (Cloud)  
* معیار اصلی قیمت گذاری است پردازنده و هارد دیسک در معیارهای بعدی هستند. 
* در نتیجه نیاز زیاد Redis به حافظه می تواند گرانقیت باشد البته درست است که Redis قابلیت استفاده از Virtual momory را دارد اما منجر به استفاده شدید I/O هارد دیسک می شود. 

## آشنایی با چند دستور پرکاربرد در Redis:

## استفاده از Client برای زبان های مختلف:

## نصب Redis:
از آنجایی که Redis برروی اکثر سیستم های عامل نصب خواهد شد، می توانید با توجه به نوع سیستم عاملی که استفاده می کنید اقدام به دانلود و نصب آخرین نسخه آن کنید.

### نصب Redis در ویندوز:
مرحله اول: ردیس را با توجه به معماری سیستم عامل و wamp server دانلود کنید: [لینک دانلود](https://redis.io/download)
  - فایل را دانلود کرده و در یک پوشه اکسترکت کنید(مثل c:\redis )
  - سپس فایل redis-server.exe را اجرا کنید. ردیس روی پورت ۶۳۷۹ بالا میاید.
  - با اجرای redis-cli.exe میتوانید محیط کامند ردیس را ببینید.
  
  مرحله دوم: با توجه به نسخه php خودتان، که میخواهید از ردیس روی آن استفاده کنید، فایل DLL مناسب با معماری سیستم و نسخه php و thread base را از این آدرس دانلود کرده و داخل پوشه زیر بریزید.
  ``` wamp\bin\php\phpx.x.xx\ext\ ```
<div dir = 'ltr'>
  
```
wamp\bin\php\phpx.x.xx\ext\
```  
</div>
  
  مرحله سوم: خط زیر را به فایل php.ini خود اضافه کنید.(دقت کنید به فایلی که در آدرس ```php\phpx.x.xx\php.ini``` اضافه کنید)
<div dir = 'ltr'>
  
```
extension=php_redis.dll
```  
</div>
  
  مرحله چهارم: حالا wamp یا php را ری‌استارت کنید. پس از بالاآمدن وب سرور میتوانید در phpinfo ببینید که نصب شده یا نه! همچنین با اجرای کد زیر میتوانید مطمئن شوید که ردیس نصب شده یا خیر:
<div dir = 'ltr'>
  
```
<?php 
try {
    $redis = new Redis();
    $redis-&gt;connect('localhost', 6379);
    $redis-&gt;set('name', 'Redis is Installed');
    echo $glueStatus = $redis-&gt;get('name');
    
} catch (Exception $ex) {
    echo $ex-&gt;getMessage();
}
```  
</div>

### نصب Redis از طریق داکر:
#### گرفتن Redis Container image
برای نصب و راه اندازی Redis طبق معمول باید Redis Container image رو از [داکر هاب](https://hub.docker.com/_/redis) روی سیستم خودمون بارگذاری کنیم تا با استفاده از اون Redis سرور های خودمون رو ایجاد کنیم. برای این کار میتونید از دستور زیر استفاده کنید.
<div dir = 'ltr'>
  
```
docker pull redis
```  
</div>

با استفاده از دستور بالا Redis نسخه latest روی سیستم شما بارگذاری میشه اگه دوست دارید تا ورژن دیگه ای بجز latest نصب کنید میتونید مانند دستور زیر اون نسخه رو روی سیستم خودتون بارگذاری کنید.
<div dir = 'ltr'>
  
```
docker pull redis:6.0-rc
```  
</div>

با استفاده از دستور بالا Redis نسخه 6.0 روی سیستم شما بارگذاری میشه که البته باید به این نکته توجه کنید که برای راه اندازی Redis هم باید مشخص کنید که شما تصمیم دارید از این نسخه یک سرور ایجاد کنید.

#### راه اندازی Redis
بعد از بارگذاری Redis با ورژن موردنظر خودتون باید با استفاده از اون یک سرور روی سیستم خودتون ایجاد کنید. برای این کار می تونید از دستور زیر استفاده کنید.
<div dir = 'ltr'>
  
```
docker run --name m-redis -p 6379:6379 -d redis
```  
</div>

بعد از زدن دستور بالا یک سرور Redis با نام ```m-redis``` روی پورت ```6379``` روی کامپیوتر شما ایجاد میشه که می تونید به راحتی به اون وصل بشید و با اون کار کنید.

### نصب Redis در لینوکس:
برای نصب آخرین نسخه stable در لینوکس دستورات زیر را به ترتیب وارد می‌کنیم:
<div dir = 'ltr'>
  
```
$ wget http://download.redis.io/redis-stable.tar.gz
$ tar xvzf redis-stable.tar.gz
$ cd redis-stable
$ make
```  
</div>

هم چنین شما می تونید از طریق apt هم به سادگی آن را نصب کنید و فقط باید بررسی کنید که کدام ورژن از Redis برای شما نصب خواهد شد:
<div dir = 'ltr'>
  
```
$ sudo apt install redis-server
```  
</div>

#### ورود به Redis Cli و بررسی وضعیت سرویس Redis
بعد از نصب Redis و برای اطمینان از نصب موفق و بالا بودن سرویس می توانید با زدن دستور زیر به redis cli وارد شوید و آن را بررسی نمایید:
<div dir = 'ltr'>
  
```
$ redis-cli
```  
</div>

بعد از اجرای دستور بالا به محیط اجرای دستورات redis وارد می شوید و برای بررسی شرایط می توانید ping را تایپ کرده و اجرا نمایید و در جواب pong بر بگیرید:
<div dir = 'ltr'>
  
```
127.0.0.1:6379> ping
PONG
```  
</div>

#### فایل پیکربندی Redis
بعد از نصب برای پیکربندی ‌Redis می توانید به سراغ فایل ```redis.conf``` بروید که اگر از سیستم عامل ubuntu استفاده می کنید در آدرس ```etc/redis/redis.conf/``` می توانید آن را پیدا کنید.
شما از طریق اعمال تغییرات در این فایل و یا دستورات command line می توانید تمامی تنظیمات Redis از جمله پورت مورد استفاده، آدرس bind شده، انتخاب روش persistence که در بالا خواندیم و هر نوع تنظیم دیگری را انجام دهید.
برای مثال برای فعال کردن AOF می توانید مقدار appendonly را در فایل خود به yes تغییر دهید:
<div dir = 'ltr'>
  
```
appendonly no
# The name of the append only file (default: "appendonly.aof")
appendfilename "appendonly.aof"
```  
</div>

فقط باید دقت کنید که اگر تا به حال از RDB استفاده می کردید و appendonly رو فعال کنید و بروید روی AOF و بعد Redis رو ریستارت کنید نمی تواند فایل رو پیدا کند و داده های شما رو sync نمی کند.
همین کار رو از طریق cli هم می توانید انجام دهید:
<div dir = 'ltr'>
  
```
config set appendonly yes
```  
</div>
به صورت پیش فرض Redis از RDB استفاده می کند و مقادیر زیر در فایل config وجود دارد که می گوید هر چند وقت و با چند تغییر اقدام به back up گیری کند:
<div dir = 'ltr'>
  
```
save 900 1
save 300 10
save 60 10000
```  
</div>
می توانید این مقادیر پیش فرض رو در فایل config خود پیدا کنید و تغییر دهید که در اینجا مشخص هست که باید بعد از گذشت ۹۰۰ ثانیه یعنی معادل ۱۵ دقیقه اگر ۱ تغییر انجام شده بود back up بگیرد و همین طور ۲ مورد پایین تر آن که در سریع ترین حالت یعنی هر ۱ دقیقه اگر ۱۰۰۰۰ تغییر داشتیم back up بگیر.

## سخن پایانی:

</div>
